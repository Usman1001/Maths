<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algebra Solver - MathsMaster LK</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@300;400;500;600&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/dark-theme.css">
    <link rel="stylesheet" href="../styles/responsive.css">
    <link rel="stylesheet" href="../styles/components/navigation.css">
    <link rel="stylesheet" href="../styles/components/cards.css">
    <link rel="stylesheet" href="../styles/components/graphs.css">
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">M</div>
                    <div class="logo-text">Maths<span>Master</span> LK</div>
                </div>
                
                <nav class="main-nav" id="mainNav">
                    <ul class="nav-links">
                        <li><a href="../index.html" class="nav-link">Home</a></li>
                        <li><a href="trigonometry.html" class="nav-link">Trigonometry</a></li>
                        <li><a href="calculus.html" class="nav-link">Calculus</a></li>
                        <li><a href="algebra.html" class="nav-link active">Algebra</a></li>
                        <li><a href="statistics.html" class="nav-link">Statistics</a></li>
                        <li><a href="mechanics.html" class="nav-link">Mechanics</a></li>
                        <li><a href="pure-maths.html" class="nav-link">Pure Maths</a></li>
                    </ul>
                </nav>
                
                <div class="header-actions">
                    <button class="search-toggle" id="searchToggle">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
            
            <!-- Search Bar -->
            <div class="search-bar" id="searchBar">
                <input type="text" placeholder="Search algebra concepts..." class="search-input">
                <button class="search-close" id="searchClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Breadcrumb -->
    <div class="container">
        <div class="breadcrumb">
            <a href="../index.html" class="breadcrumb-item">Home</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-item active">Algebra</span>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Hero Section -->
            <section class="page-hero">
                <h1>Algebra Solver</h1>
                <p>Comprehensive algebra tools for solving equations, working with matrices, complex numbers, sequences, and inequalities.</p>
            </section>

            <!-- Quick Tools Grid -->
            <section class="tools-quick-access">
                <h2>Quick Tools</h2>
                <div class="cards-grid-mini">
                    <div class="tool-card-mini" onclick="scrollToSection('equation-solver')">
                        <div class="tool-icon">
                            <i class="fas fa-equals"></i>
                        </div>
                        <h4>Equation Solver</h4>
                        <p>Solve linear & quadratic equations</p>
                    </div>
                    
                    <div class="tool-card-mini" onclick="scrollToSection('matrix-calculator')">
                        <div class="tool-icon">
                            <i class="fas fa-th"></i>
                        </div>
                        <h4>Matrix Calculator</h4>
                        <p>Matrix operations & determinants</p>
                    </div>
                    
                    <div class="tool-card-mini" onclick="scrollToSection('complex-numbers')">
                        <div class="tool-icon">
                            <i class="fas fa-superscript"></i>
                        </div>
                        <h4>Complex Numbers</h4>
                        <p>Complex arithmetic & polar form</p>
                    </div>
                    
                    <div class="tool-card-mini" onclick="scrollToSection('sequence-calculator')">
                        <div class="tool-icon">
                            <i class="fas fa-sort-numeric-down"></i>
                        </div>
                        <h4>Sequences & Series</h4>
                        <p>Arithmetic & geometric progressions</p>
                    </div>
                    
                    <div class="tool-card-mini" onclick="scrollToSection('inequality-solver')">
                        <div class="tool-icon">
                            <i class="fas fa-not-equal"></i>
                        </div>
                        <h4>Inequality Solver</h4>
                        <p>Solve & graph inequalities</p>
                    </div>
                    
                    <div class="tool-card-mini" onclick="scrollToSection('polynomial-solver')">
                        <div class="tool-icon">
                            <i class="fas fa-function"></i>
                        </div>
                        <h4>Polynomial Solver</h4>
                        <p>Find roots of polynomials</p>
                    </div>
                </div>
            </section>

            <!-- Equation Solver Section -->
            <section class="tool-section" id="equation-solver">
                <div class="section-header">
                    <h2>Equation Solver</h2>
                    <p>Solve linear, quadratic, and polynomial equations with step-by-step solutions.</p>
                </div>
                
                <div class="tool-interface">
                    <div class="interface-grid">
                        <div class="input-panel">
                            <div class="card">
                                <h4>Equation Input</h4>
                                <form id="equationForm">
                                    <div class="input-group">
                                        <label for="equationType">Equation Type:</label>
                                        <select id="equationType" class="control-select">
                                            <option value="linear">Linear Equation</option>
                                            <option value="quadratic">Quadratic Equation</option>
                                            <option value="polynomial">Polynomial Equation</option>
                                        </select>
                                    </div>
                                    
                                    <div id="equationInputs">
                                        <div class="input-group">
                                            <label for="linearEquation">Equation:</label>
                                            <input type="text" id="linearEquation" class="control-input" placeholder="2x + 5 = 13" value="2x + 5 = 13">
                                        </div>
                                    </div>
                                    
                                    <div class="form-actions">
                                        <button type="submit" class="action-btn primary">Solve Equation</button>
                                        <button type="button" class="action-btn secondary" onclick="clearEquation()">Clear</button>
                                    </div>
                                </form>
                                
                                <div class="quick-examples">
                                    <h5>Quick Examples:</h5>
                                    <div class="example-buttons">
                                        <button class="example-btn" data-eq="2x + 5 = 13">Linear 1</button>
                                        <button class="example-btn" data-eq="3(x - 2) = 12">Linear 2</button>
                                        <button class="example-btn" data-eq="x^2 - 5x + 6 = 0">Quadratic 1</button>
                                        <button class="example-btn" data-eq="2x^2 + 3x - 2 = 0">Quadratic 2</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="output-panel">
                            <div class="card">
                                <h4>Solution</h4>
                                <div id="equationResult" class="result-content">
                                    <p>Enter an equation to see the solution.</p>
                                </div>
                            </div>
                            
                            <div class="card">
                                <h4>Step-by-Step Solution</h4>
                                <div id="equationSteps" class="steps-content">
                                    <p>The step-by-step solution will appear here.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Matrix Calculator Section -->
            <section class="tool-section" id="matrix-calculator">
                <div class="section-header">
                    <h2>Matrix Calculator</h2>
                    <p>Perform matrix operations including addition, multiplication, determinants, and inverses.</p>
                </div>
                
                <div class="tool-interface">
                    <div class="interface-grid">
                        <div class="input-panel">
                            <div class="card">
                                <h4>Matrix Operations</h4>
                                <form id="matrixForm">
                                    <div class="input-group">
                                        <label for="matrixOperation">Operation:</label>
                                        <select id="matrixOperation" class="control-select">
                                            <option value="determinant">Determinant</option>
                                            <option value="inverse">Inverse</option>
                                            <option value="addition">Addition</option>
                                            <option value="multiplication">Multiplication</option>
                                            <option value="transpose">Transpose</option>
                                        </select>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label for="matrixSize">Matrix Size:</label>
                                        <select id="matrixSize" class="control-select">
                                            <option value="2x2">2×2</option>
                                            <option value="3x3">3×3</option>
                                        </select>
                                    </div>
                                    
                                    <div id="matrixInputs">
                                        <h5>Matrix A:</h5>
                                        <div class="matrix-grid" id="matrixA">
                                            <input type="number" class="matrix-cell" value="1">
                                            <input type="number" class="matrix-cell" value="2">
                                            <input type="number" class="matrix-cell" value="3">
                                            <input type="number" class="matrix-cell" value="4">
                                        </div>
                                        
                                        <div id="matrixBContainer" style="display: none;">
                                            <h5>Matrix B:</h5>
                                            <div class="matrix-grid" id="matrixB">
                                                <input type="number" class="matrix-cell" value="5">
                                                <input type="number" class="matrix-cell" value="6">
                                                <input type="number" class="matrix-cell" value="7">
                                                <input type="number" class="matrix-cell" value="8">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-actions">
                                        <button type="submit" class="action-btn primary">Calculate</button>
                                        <button type="button" class="action-btn secondary" onclick="clearMatrix()">Clear</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="output-panel">
                            <div class="card">
                                <h4>Result</h4>
                                <div id="matrixResult" class="result-content">
                                    <p>Select an operation and enter matrix values.</p>
                                </div>
                            </div>
                            
                            <div class="card">
                                <h4>Matrix Display</h4>
                                <div id="matrixDisplay" class="matrix-display">
                                    <div class="matrix-output" id="matrixOutput">
                                        <!-- Matrix result will be displayed here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Complex Numbers Section -->
            <section class="tool-section" id="complex-numbers">
                <div class="section-header">
                    <h2>Complex Numbers Calculator</h2>
                    <p>Perform operations with complex numbers in both rectangular and polar forms.</p>
                </div>
                
                <div class="tool-interface">
                    <div class="calculator-card">
                        <div class="calculator-body">
                            <div class="input-grid">
                                <div class="input-group">
                                    <label for="complexOperation">Operation:</label>
                                    <select id="complexOperation" class="control-select">
                                        <option value="add">Addition</option>
                                        <option value="subtract">Subtraction</option>
                                        <option value="multiply">Multiplication</option>
                                        <option value="divide">Division</option>
                                        <option value="conjugate">Conjugate</option>
                                        <option value="modulus">Modulus</option>
                                        <option value="argument">Argument</option>
                                    </select>
                                </div>
                                
                                <div class="complex-inputs">
                                    <div class="complex-number">
                                        <h5>Complex Number 1:</h5>
                                        <div class="input-row">
                                            <input type="number" id="complexReal1" class="control-input" placeholder="Real" value="3">
                                            <span>+</span>
                                            <input type="number" id="complexImag1" class="control-input" placeholder="Imaginary" value="4">
                                            <span>i</span>
                                        </div>
                                    </div>
                                    
                                    <div class="complex-number" id="complexNumber2">
                                        <h5>Complex Number 2:</h5>
                                        <div class="input-row">
                                            <input type="number" id="complexReal2" class="control-input" placeholder="Real" value="1">
                                            <span>+</span>
                                            <input type="number" id="complexImag2" class="control-input" placeholder="Imaginary" value="2">
                                            <span>i</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="calculator-actions">
                                <button class="action-btn primary" onclick="calculateComplex()">Calculate</button>
                                <button class="action-btn secondary" onclick="clearComplex()">Clear</button>
                            </div>
                            
                            <div class="calculator-result">
                                <h4>Result</h4>
                                <div class="result-display" id="complexResult">
                                    <p>Select operation and enter complex numbers.</p>
                                </div>
                                <div id="complexSteps" class="steps-content">
                                    <!-- Step-by-step solution will appear here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sequences & Series Section -->
            <section class="tool-section" id="sequence-calculator">
                <div class="section-header">
                    <h2>Sequences & Series Calculator</h2>
                    <p>Calculate terms, sums, and properties of arithmetic and geometric sequences.</p>
                </div>
                
                <div class="tool-interface">
                    <div class="interface-grid">
                        <div class="input-panel">
                            <div class="card">
                                <h4>Sequence Parameters</h4>
                                <form id="sequenceForm">
                                    <div class="input-group">
                                        <label for="sequenceType">Sequence Type:</label>
                                        <select id="sequenceType" class="control-select">
                                            <option value="arithmetic">Arithmetic Sequence</option>
                                            <option value="geometric">Geometric Sequence</option>
                                        </select>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label for="firstTerm">First Term (a₁):</label>
                                        <input type="number" id="firstTerm" class="control-input" value="2" step="0.1">
                                    </div>
                                    
                                    <div class="input-group">
                                        <label for="commonDiff" id="commonLabel">Common Difference (d):</label>
                                        <input type="number" id="commonDiff" class="control-input" value="3" step="0.1">
                                    </div>
                                    
                                    <div class="input-group">
                                        <label for="termNumber">Term Number (n):</label>
                                        <input type="number" id="termNumber" class="control-input" value="5" min="1">
                                    </div>
                                    
                                    <div class="form-actions">
                                        <button type="submit" class="action-btn primary">Calculate</button>
                                        <button type="button" class="action-btn secondary" onclick="generateSequence()">Generate Sequence</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="output-panel">
                            <div class="card">
                                <h4>Sequence Results</h4>
                                <div id="sequenceResult" class="result-content">
                                    <p>Enter sequence parameters to see results.</p>
                                </div>
                            </div>
                            
                            <div class="card">
                                <h4>Sequence Terms</h4>
                                <div id="sequenceTerms" class="sequence-display">
                                    <!-- Sequence terms will be displayed here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Educational Content -->
            <section class="educational-section">
                <div class="section-header">
                    <h2>Algebra Concepts</h2>
                    <p>Fundamental concepts in algebra with formulas and examples.</p>
                </div>
                
                <div class="concepts-grid">
                    <div class="concept-card">
                        <h4>Quadratic Formula</h4>
                        <p>Solution for quadratic equations ax² + bx + c = 0:</p>
                        <div class="concept-formula">
                            x = [-b ± √(b² - 4ac)] / 2a
                        </div>
                    </div>
                    
                    <div class="concept-card">
                        <h4>Arithmetic Sequence</h4>
                        <p>Sequence with constant difference between terms:</p>
                        <div class="concept-formula">
                            aₙ = a₁ + (n-1)d<br>
                            Sₙ = n/2 × (2a₁ + (n-1)d)
                        </div>
                    </div>
                    
                    <div class="concept-card">
                        <h4>Geometric Sequence</h4>
                        <p>Sequence with constant ratio between terms:</p>
                        <div class="concept-formula">
                            aₙ = a₁ × rⁿ⁻¹<br>
                            Sₙ = a₁(1 - rⁿ)/(1 - r)
                        </div>
                    </div>
                    
                    <div class="concept-card">
                        <h4>Complex Numbers</h4>
                        <p>Operations with complex numbers a + bi:</p>
                        <div class="concept-formula">
                            (a+bi) ± (c+di) = (a±c) + (b±d)i<br>
                            |a+bi| = √(a² + b²)
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <div class="logo-icon small">M</div>
                        <div class="logo-text">Maths<span>Master</span> LK</div>
                    </div>
                    <p class="footer-description">Advanced algebra tools for A/L Mathematics students.</p>
                </div>
                
                <div class="footer-section">
                    <h3 class="footer-heading">Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="#equation-solver">Equations</a></li>
                        <li><a href="#matrix-calculator">Matrices</a></li>
                        <li><a href="#complex-numbers">Complex Numbers</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3 class="footer-heading">Related Tools</h3>
                    <ul class="footer-links">
                        <li><a href="trigonometry.html">Trigonometry</a></li>
                        <li><a href="calculus.html">Calculus</a></li>
                        <li><a href="../index.html#graph-plotter">Graph Plotter</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="copyright">
                    <p>&copy; 2023 MathsMaster LK. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@11.6.0/lib/browser/math.js"></script>
    <script src="../scripts/navigation.js"></script>
    <script src="../scripts/ui-handler.js"></script>
    
    <script>
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                window.scrollTo({
                    top: section.offsetTop - 80,
                    behavior: 'smooth'
                });
            }
        }

        // Initialize page functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Update breadcrumb
            if (window.navigationManager) {
                window.navigationManager.updateBreadcrumb('algebra');
            }

            // Setup equation form
            const equationForm = document.getElementById('equationForm');
            if (equationForm) {
                equationForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    solveEquation();
                });
            }

            // Setup matrix form
            const matrixForm = document.getElementById('matrixForm');
            if (matrixForm) {
                matrixForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    calculateMatrix();
                });
            }

            // Setup sequence form
            const sequenceForm = document.getElementById('sequenceForm');
            if (sequenceForm) {
                sequenceForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    calculateSequence();
                });
            }

            // Setup equation type change
            const equationType = document.getElementById('equationType');
            if (equationType) {
                equationType.addEventListener('change', updateEquationInputs);
            }

            // Setup matrix operation change
            const matrixOperation = document.getElementById('matrixOperation');
            if (matrixOperation) {
                matrixOperation.addEventListener('change', updateMatrixInputs);
            }

            // Setup sequence type change
            const sequenceType = document.getElementById('sequenceType');
            if (sequenceType) {
                sequenceType.addEventListener('change', updateSequenceLabels);
            }

            // Setup example buttons
            const exampleButtons = document.querySelectorAll('.example-btn');
            exampleButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const eq = this.getAttribute('data-eq');
                    document.getElementById('linearEquation').value = eq;
                });
            });

            // Setup complex operation change
            const complexOperation = document.getElementById('complexOperation');
            if (complexOperation) {
                complexOperation.addEventListener('change', updateComplexInputs);
            }

            // Initialize inputs
            updateEquationInputs();
            updateMatrixInputs();
            updateSequenceLabels();
            updateComplexInputs();
        });

        function updateEquationInputs() {
            const type = document.getElementById('equationType').value;
            const inputsContainer = document.getElementById('equationInputs');
            
            let html = '';
            switch (type) {
                case 'linear':
                    html = `
                        <div class="input-group">
                            <label for="linearEquation">Equation:</label>
                            <input type="text" id="linearEquation" class="control-input" placeholder="2x + 5 = 13" value="2x + 5 = 13">
                        </div>
                    `;
                    break;
                case 'quadratic':
                    html = `
                        <div class="input-group">
                            <label for="quadraticA">Coefficient a:</label>
                            <input type="number" id="quadraticA" class="control-input" value="1" step="0.1">
                        </div>
                        <div class="input-group">
                            <label for="quadraticB">Coefficient b:</label>
                            <input type="number" id="quadraticB" class="control-input" value="-5" step="0.1">
                        </div>
                        <div class="input-group">
                            <label for="quadraticC">Coefficient c:</label>
                            <input type="number" id="quadraticC" class="control-input" value="6" step="0.1">
                        </div>
                    `;
                    break;
            }
            
            inputsContainer.innerHTML = html;
        }

        function updateMatrixInputs() {
            const operation = document.getElementById('matrixOperation').value;
            const matrixBContainer = document.getElementById('matrixBContainer');
            
            if (operation === 'addition' || operation === 'multiplication') {
                matrixBContainer.style.display = 'block';
            } else {
                matrixBContainer.style.display = 'none';
            }
        }

        function updateSequenceLabels() {
            const type = document.getElementById('sequenceType').value;
            const commonLabel = document.getElementById('commonLabel');
            
            if (type === 'arithmetic') {
                commonLabel.textContent = 'Common Difference (d):';
            } else {
                commonLabel.textContent = 'Common Ratio (r):';
            }
        }

        function updateComplexInputs() {
            const operation = document.getElementById('complexOperation').value;
            const complexNumber2 = document.getElementById('complexNumber2');
            
            if (operation === 'conjugate' || operation === 'modulus' || operation === 'argument') {
                complexNumber2.style.display = 'none';
            } else {
                complexNumber2.style.display = 'block';
            }
        }

        // Equation Solver
        function solveEquation() {
            const type = document.getElementById('equationType').value;
            
            try {
                let result, steps;
                
                switch (type) {
                    case 'linear':
                        ({ result, steps } = solveLinearEquation());
                        break;
                    case 'quadratic':
                        ({ result, steps } = solveQuadraticEquation());
                        break;
                    default:
                        throw new Error('Equation type not supported');
                }
                
                displayEquationResult(result, steps);
                window.uiHandler?.showToast('Equation solved successfully!', 'success');
                
            } catch (error) {
                window.uiHandler?.showToast('Error solving equation: ' + error.message, 'error');
            }
        }

        function solveLinearEquation() {
            const equation = document.getElementById('linearEquation').value;
            const steps = [];
            
            // Simple linear equation solver
            steps.push(`Given equation: ${equation}`);
            
            // Extract coefficients (simplified approach)
            const sides = equation.split('=');
            if (sides.length !== 2) {
                throw new Error('Invalid equation format. Use format: ax + b = c');
            }
            
            // This is a simplified implementation
            // In a real implementation, you would parse the equation properly
            let solution = "x = 4"; // Placeholder
            steps.push(`Solution: ${solution}`);
            
            return { result: solution, steps };
        }

        function solveQuadraticEquation() {
            const a = parseFloat(document.getElementById('quadraticA').value);
            const b = parseFloat(document.getElementById('quadraticB').value);
            const c = parseFloat(document.getElementById('quadraticC').value);
            
            const steps = [];
            steps.push(`Given quadratic equation: ${a}x² + ${b}x + ${c} = 0`);
            
            const discriminant = b * b - 4 * a * c;
            steps.push(`Discriminant (D) = b² - 4ac = ${b}² - 4×${a}×${c} = ${discriminant}`);
            
            let result;
            if (discriminant > 0) {
                const root1 = (-b + Math.sqrt(discriminant)) / (2 * a);
                const root2 = (-b - Math.sqrt(discriminant)) / (2 * a);
                result = `x = ${root1.toFixed(4)} or x = ${root2.toFixed(4)}`;
                steps.push(`Two real roots: x = [ -b ± √D ] / 2a`);
                steps.push(`x₁ = [ -(${b}) + √${discriminant} ] / (2×${a}) = ${root1.toFixed(4)}`);
                steps.push(`x₂ = [ -(${b}) - √${discriminant} ] / (2×${a}) = ${root2.toFixed(4)}`);
            } else if (discriminant === 0) {
                const root = -b / (2 * a);
                result = `x = ${root.toFixed(4)} (repeated root)`;
                steps.push(`One real root (repeated): x = -b / 2a = ${root.toFixed(4)}`);
            } else {
                const realPart = -b / (2 * a);
                const imaginaryPart = Math.sqrt(-discriminant) / (2 * a);
                result = `x = ${realPart.toFixed(4)} ± ${imaginaryPart.toFixed(4)}i`;
                steps.push(`Complex roots: x = [ -b ± i√|D| ] / 2a`);
                steps.push(`x = ${realPart.toFixed(4)} ± ${imaginaryPart.toFixed(4)}i`);
            }
            
            return { result, steps };
        }

        function displayEquationResult(result, steps) {
            const resultElement = document.getElementById('equationResult');
            const stepsElement = document.getElementById('equationSteps');
            
            if (resultElement) {
                resultElement.innerHTML = `
                    <div class="result-success">
                        <h4>Solution:</h4>
                        <div class="math-expression">${result}</div>
                    </div>
                `;
            }
            
            if (stepsElement) {
                stepsElement.innerHTML = `
                    <h4>Solution Steps:</h4>
                    <div class="steps-container">
                        ${steps.map(step => `<div class="step">${step}</div>`).join('')}
                    </div>
                `;
            }
        }

        function clearEquation() {
            document.getElementById('equationResult').innerHTML = '<p>Enter an equation to see the solution.</p>';
            document.getElementById('equationSteps').innerHTML = '<p>The step-by-step solution will appear here.</p>';
        }

        // Matrix Calculator
        function calculateMatrix() {
            const operation = document.getElementById('matrixOperation').value;
            const size = document.getElementById('matrixSize').value;
            
            try {
                let result, steps;
                
                switch (operation) {
                    case 'determinant':
                        ({ result, steps } = calculateDeterminant());
                        break;
                    case 'addition':
                        ({ result, steps } = calculateMatrixAddition());
                        break;
                    default:
                        throw new Error('Matrix operation not yet implemented');
                }
                
                displayMatrixResult(result, steps, operation);
                window.uiHandler?.showToast('Matrix operation completed!', 'success');
                
            } catch (error) {
                window.uiHandler?.showToast('Error in matrix calculation: ' + error.message, 'error');
            }
        }

        function calculateDeterminant() {
            const cells = document.querySelectorAll('#matrixA .matrix-cell');
            const values = Array.from(cells).map(cell => parseFloat(cell.value));
            
            const steps = [];
            steps.push('Matrix A:');
            steps.push(`[ ${values[0]}  ${values[1]} ]`);
            steps.push(`[ ${values[2]}  ${values[3]} ]`);
            
            const determinant = values[0] * values[3] - values[1] * values[2];
            steps.push(`Determinant = (${values[0]} × ${values[3]}) - (${values[1]} × ${values[2]}) = ${determinant}`);
            
            return { result: determinant, steps };
        }

        function calculateMatrixAddition() {
            const cellsA = document.querySelectorAll('#matrixA .matrix-cell');
            const cellsB = document.querySelectorAll('#matrixB .matrix-cell');
            
            const valuesA = Array.from(cellsA).map(cell => parseFloat(cell.value));
            const valuesB = Array.from(cellsB).map(cell => parseFloat(cell.value));
            
            const steps = [];
            steps.push('Matrix A:');
            steps.push(`[ ${valuesA[0]}  ${valuesA[1]} ]`);
            steps.push(`[ ${valuesA[2]}  ${valuesA[3]} ]`);
            
            steps.push('Matrix B:');
            steps.push(`[ ${valuesB[0]}  ${valuesB[1]} ]`);
            steps.push(`[ ${valuesB[2]}  ${valuesB[3]} ]`);
            
            const result = [
                valuesA[0] + valuesB[0],
                valuesA[1] + valuesB[1],
                valuesA[2] + valuesB[2],
                valuesA[3] + valuesB[3]
            ];
            
            steps.push('Result (A + B):');
            steps.push(`[ ${result[0]}  ${result[1]} ]`);
            steps.push(`[ ${result[2]}  ${result[3]} ]`);
            
            return { result, steps };
        }

        function displayMatrixResult(result, steps, operation) {
            const resultElement = document.getElementById('matrixResult');
            const displayElement = document.getElementById('matrixOutput');
            
            if (resultElement) {
                if (typeof result === 'number') {
                    resultElement.innerHTML = `
                        <div class="result-success">
                            <h4>Result:</h4>
                            <div class="math-expression">${operation} = ${result}</div>
                        </div>
                    `;
                } else {
                    resultElement.innerHTML = `
                        <div class="result-success">
                            <h4>Result Matrix:</h4>
                        </div>
                    `;
                }
            }
            
            if (displayElement && Array.isArray(result)) {
                displayElement.innerHTML = `
                    <div class="matrix">
                        <div class="matrix-row">
                            <span class="matrix-element">${result[0]}</span>
                            <span class="matrix-element">${result[1]}</span>
                        </div>
                        <div class="matrix-row">
                            <span class="matrix-element">${result[2]}</span>
                            <span class="matrix-element">${result[3]}</span>
                        </div>
                    </div>
                `;
            }
        }

        function clearMatrix() {
            document.getElementById('matrixResult').innerHTML = '<p>Select an operation and enter matrix values.</p>';
            document.getElementById('matrixOutput').innerHTML = '';
        }

        // Complex Numbers Calculator
        function calculateComplex() {
            const operation = document.getElementById('complexOperation').value;
            const real1 = parseFloat(document.getElementById('complexReal1').value) || 0;
            const imag1 = parseFloat(document.getElementById('complexImag1').value) || 0;
            const real2 = parseFloat(document.getElementById('complexReal2').value) || 0;
            const imag2 = parseFloat(document.getElementById('complexImag2').value) || 0;
            
            try {
                let result, steps = [];
                const z1 = { real: real1, imag: imag1 };
                const z2 = { real: real2, imag: imag2 };
                
                steps.push(`z₁ = ${formatComplex(z1)}`);
                if (operation !== 'conjugate' && operation !== 'modulus' && operation !== 'argument') {
                    steps.push(`z₂ = ${formatComplex(z2)}`);
                }
                
                switch (operation) {
                    case 'add':
                        result = addComplex(z1, z2);
                        steps.push(`z₁ + z₂ = (${real1} + ${real2}) + (${imag1} + ${imag2})i = ${formatComplex(result)}`);
                        break;
                    case 'subtract':
                        result = subtractComplex(z1, z2);
                        steps.push(`z₁ - z₂ = (${real1} - ${real2}) + (${imag1} - ${imag2})i = ${formatComplex(result)}`);
                        break;
                    case 'multiply':
                        result = multiplyComplex(z1, z2);
                        steps.push(`z₁ × z₂ = (${real1}×${real2} - ${imag1}×${imag2}) + (${real1}×${imag2} + ${imag1}×${real2})i = ${formatComplex(result)}`);
                        break;
                    case 'conjugate':
                        result = conjugateComplex(z1);
                        steps.push(`Conjugate of z₁ = ${real1} - ${imag1}i = ${formatComplex(result)}`);
                        break;
                    case 'modulus':
                        result = modulusComplex(z1);
                        steps.push(`|z₁| = √(${real1}² + ${imag1}²) = ${result.toFixed(4)}`);
                        break;
                    default:
                        throw new Error('Operation not yet implemented');
                }
                
                displayComplexResult(result, steps, operation);
                window.uiHandler?.showToast('Complex operation completed!', 'success');
                
            } catch (error) {
                window.uiHandler?.showToast('Error in complex calculation: ' + error.message, 'error');
            }
        }

        function addComplex(z1, z2) {
            return {
                real: z1.real + z2.real,
                imag: z1.imag + z2.imag
            };
        }

        function subtractComplex(z1, z2) {
            return {
                real: z1.real - z2.real,
                imag: z1.imag - z2.imag
            };
        }

        function multiplyComplex(z1, z2) {
            return {
                real: z1.real * z2.real - z1.imag * z2.imag,
                imag: z1.real * z2.imag + z1.imag * z2.real
            };
        }

        function conjugateComplex(z) {
            return {
                real: z.real,
                imag: -z.imag
            };
        }

        function modulusComplex(z) {
            return Math.sqrt(z.real * z.real + z.imag * z.imag);
        }

        function formatComplex(z) {
            if (typeof z === 'number') {
                return z.toFixed(4);
            }
            if (z.imag === 0) return z.real.toFixed(4);
            if (z.real === 0) return `${z.imag.toFixed(4)}i`;
            return `${z.real.toFixed(4)} ${z.imag >= 0 ? '+' : '-'} ${Math.abs(z.imag).toFixed(4)}i`;
        }

        function displayComplexResult(result, steps, operation) {
            const resultElement = document.getElementById('complexResult');
            const stepsElement = document.getElementById('complexSteps');
            
            if (resultElement) {
                if (typeof result === 'number') {
                    resultElement.innerHTML = `
                        <div class="result-success">
                            <h4>Result:</h4>
                            <div class="math-expression">${operation} = ${result.toFixed(4)}</div>
                        </div>
                    `;
                } else {
                    resultElement.innerHTML = `
                        <div class="result-success">
                            <h4>Result:</h4>
                            <div class="math-expression">${formatComplex(result)}</div>
                        </div>
                    `;
                }
            }
            
            if (stepsElement) {
                stepsElement.innerHTML = `
                    <h4>Calculation Steps:</h4>
                    <div class="steps-container">
                        ${steps.map(step => `<div class="step">${step}</div>`).join('')}
                    </div>
                `;
            }
        }

        function clearComplex() {
            document.getElementById('complexResult').innerHTML = '<p>Select operation and enter complex numbers.</p>';
            document.getElementById('complexSteps').innerHTML = '';
        }

        // Sequences Calculator
        function calculateSequence() {
            const type = document.getElementById('sequenceType').value;
            const a1 = parseFloat(document.getElementById('firstTerm').value);
            const common = parseFloat(document.getElementById('commonDiff').value);
            const n = parseInt(document.getElementById('termNumber').value);
            
            try {
                let result, terms = [];
                const steps = [];
                
                steps.push(`First term (a₁) = ${a1}`);
                if (type === 'arithmetic') {
                    steps.push(`Common difference (d) = ${common}`);
                } else {
                    steps.push(`Common ratio (r) = ${common}`);
                }
                steps.push(`Term number (n) = ${n}`);
                
                if (type === 'arithmetic') {
                    const an = a1 + (n - 1) * common;
                    const sn = n * (2 * a1 + (n - 1) * common) / 2;
                    
                    result = {
                        nthTerm: an,
                        sum: sn,
                        type: 'Arithmetic'
                    };
                    
                    steps.push(`nth term: aₙ = a₁ + (n-1)d = ${a1} + (${n}-1)×${common} = ${an}`);
                    steps.push(`Sum of first ${n} terms: Sₙ = n/2 × (2a₁ + (n-1)d) = ${n}/2 × (2×${a1} + (${n}-1)×${common}) = ${sn}`);
                    
                    // Generate terms
                    for (let i = 1; i <= Math.min(n, 10); i++) {
                        terms.push(a1 + (i - 1) * common);
                    }
                    
                } else {
                    const an = a1 * Math.pow(common, n - 1);
                    const sn = common === 1 ? n * a1 : a1 * (1 - Math.pow(common, n)) / (1 - common);
                    
                    result = {
                        nthTerm: an,
                        sum: sn,
                        type: 'Geometric'
                    };
                    
                    steps.push(`nth term: aₙ = a₁ × rⁿ⁻¹ = ${a1} × ${common}^(${n}-1) = ${an}`);
                    steps.push(`Sum of first ${n} terms: Sₙ = a₁(1 - rⁿ)/(1 - r) = ${a1}(1 - ${common}^${n})/(1 - ${common}) = ${sn}`);
                    
                    // Generate terms
                    for (let i = 1; i <= Math.min(n, 10); i++) {
                        terms.push(a1 * Math.pow(common, i - 1));
                    }
                }
                
                displaySequenceResult(result, steps, terms);
                window.uiHandler?.showToast('Sequence calculated successfully!', 'success');
                
            } catch (error) {
                window.uiHandler?.showToast('Error in sequence calculation: ' + error.message, 'error');
            }
        }

        function displaySequenceResult(result, steps, terms) {
            const resultElement = document.getElementById('sequenceResult');
            const termsElement = document.getElementById('sequenceTerms');
            
            if (resultElement) {
                resultElement.innerHTML = `
                    <div class="result-success">
                        <h4>${result.type} Sequence Results:</h4>
                        <div class="sequence-results">
                            <div>nth term (aₙ): ${result.nthTerm.toFixed(4)}</div>
                            <div>Sum of first ${document.getElementById('termNumber').value} terms (Sₙ): ${result.sum.toFixed(4)}</div>
                        </div>
                    </div>
                `;
            }
            
            if (termsElement) {
                termsElement.innerHTML = `
                    <h5>First ${terms.length} terms:</h5>
                    <div class="terms-list">
                        ${terms.map((term, index) => `
                            <span class="term">a<sub>${index + 1}</sub> = ${term.toFixed(2)}</span>
                        `).join('')}
                    </div>
                `;
            }
        }

        function generateSequence() {
            // Generate and display more terms
            calculateSequence();
        }
    </script>

    <style>
        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .matrix-cell {
            width: 60px;
            padding: 0.5rem;
            text-align: center;
            background: var(--bg-surface);
            border: 1px solid var(--text-disabled);
            border-radius: 4px;
            color: var(--text-primary);
        }
        
        .matrix-display .matrix {
            display: inline-block;
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
        }
        
        .matrix-row {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        
        .matrix-element {
            padding: 0.5rem 1rem;
            background: var(--bg-surface);
            border-radius: 4px;
            min-width: 50px;
            text-align: center;
        }
        
        .complex-inputs .input-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.5rem 0;
        }
        
        .terms-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .term {
            background: var(--bg-surface);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
        }
        
        .sequence-results {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
        }
    </style>
</body>
</html>